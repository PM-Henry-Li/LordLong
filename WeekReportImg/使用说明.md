# 周报图片生成器使用说明

## 功能介绍

本脚本用于根据项目周报数据自动生成可视化图表，支持两种视图：
- **视图 A**：包含 M端、P端、线下三个维度
- **视图 B**：仅包含 P端、线下（剔除M端后重新计算）

## 使用方法

### 1. 准备数据文件

在 `WeekReportImg` 目录下编辑 `data.txt` 文件，使用以下格式：

```
【季度计划】
Q3已排长线计划总计30项，已启动24项，推进率80%；
M端10项，已启动9项，推进率90%；
P端7项，已启动5项，推进率71%；
线下端13项，已启动10项，推进率77%；
【月度计划】
1月已排长线计划总计33项，已启动33项，推进率100%；
M端10项，已启动10项，推进率100%；
P端10项，已启动10项，推进率100%；
线下端13项，已启动13项，推进率100%；
【迭代计划】
0119已排计划总计57项，已启动57项，推进率100%；
M端17项
P端17项
线下端23项
```

### 2. 运行脚本

```bash
cd WeekReportImg
python3 weeKReportImgGen.py
```

### 3. 查看输出

脚本将在 `output` 目录下生成以下文件：
- `周报_视图A_YYYY-MM-DD.svg` - 视图A（包含M端、P端、线下）
- `周报_视图B_YYYY-MM-DD.svg` - 视图B（仅包含P端、线下）

其中 `YYYY-MM-DD` 为当天日期。

## 数据格式说明

### 支持的分组类型

使用 `【分组名】` 标记不同的项目分组：
- `【季度计划】` - 季度计划数据
- `【月度计划】` - 月度计划数据
- `【迭代计划】` - 迭代计划数据

### 分组内容格式

每个分组包含：
1. **第一行**：总计数据（必需）
   - 格式：`计划名已排长线计划总计XX项，已启动XX项，推进率XX%；`
   - 示例：`Q3已排长线计划总计30项，已启动24项，推进率80%；`

2. **后续行**：各平台数据（M端、P端、线下端）
   - 完整格式：`平台名XX项，已启动XX项，推进率XX%；`
   - 简化格式：`平台名XX项`（当总体推进率为100%时使用）
   - 示例：`M端10项，已启动9项，推进率90%；`

### 支持的平台名称

- `M端` - 移动端
- `P端` - PC端
- `线下` 或 `线下端` - 线下渠道（自动转换为"线下"）

### 推进率处理规则

1. **如果明确指定推进率**：使用指定的推进率
2. **如果未指定推进率**：
   - 当总体推进率为100%时，默认该项也100%
   - 其他情况根据已启动数计算推进率

3. **数据补全**：
   - 如果推进率为100%但未指定已启动数，则默认已启动数=计划数
   - 示例：`M端17项`（总体推进率100%）→ 自动补全为 `M端17项，已启动17项，推进率100%`

### 数据示例

#### 示例1：完整的季度计划数据
```
【季度计划】
Q3已排长线计划总计30项，已启动24项，推进率80%；
M端10项，已启动9项，推进率90%；
P端7项，已启动5项，推进率71%；
线下端13项，已启动10项，推进率77%；
```

#### 示例2：推进率100%的简化写法
```
【月度计划】
1月已排长线计划总计33项，已启动33项，推进率100%；
M端10项
P端10项
线下端13项
```

说明：当总体推进率为100%时，各分项可以只写计划数，系统会自动补全为已启动数=计划数，推进率=100%

## 视图说明

### 视图 A（M端 & P端 & 线下）

- 显示所有三个维度的数据
- 总进度 = (M端已启动 + P端已启动 + 线下已启动) / (M端计划 + P端计划 + 线下计划)
- 颜色：
  - M端: 紫色 (#8b5cf6)
  - P端: 蓝色 (#3b82f6)
  - 线下: 绿色 (#10b981)

### 视图 B（剔除 M端）

- 仅显示 P端和线下的数据
- 总进度 = (P端已启动 + 线下已启动) / (P端计划 + 线下计划)
- 重新计算总数和推进率
- 颜色与视图 A 保持一致

## 输出格式

### 图片规格

- **尺寸**: 880px × 480px
- **格式**: SVG（矢量图）
- **背景**: 浅灰色 (#f9fafb)
- **卡片**: 白色背景，圆角设计

### 卡片布局

- 最多显示 3 个卡片（横向排列）
- 每个卡片宽度 270px
- 卡片间距 35px

### 卡片内容

1. **标题区域**：项目名称 + 视图说明
2. **主统计区**：已启动数 / 总计划 + 推进率百分比
3. **主进度条**：显示整体进度
4. **分隔线**
5. **分项详情**：每个平台的具体数据和进度条

## 转换为PNG格式

生成的SVG文件可以直接在浏览器中打开。如需转换为PNG格式，可以使用以下方法：

### 方法1：在线转换
访问：https://cloudconvert.com/svg-to-png

### 方法2：使用命令行工具（需要安装）

**macOS:**
```bash
brew install librsvg
rsvg-convert -f png -o output.png input.svg
```

**Ubuntu/Debian:**
```bash
sudo apt-get install librsvg2-bin
rsvg-convert -f png -o output.png input.svg
```

**Windows:**
下载 Inkscape 并使用命令行：
```
inkscape input.svg --export-filename=output.png --export-type=png
```

## 注意事项

1. **文件编码**：确保 `data.txt` 使用 UTF-8 编码
2. **数据更新**：每周更新 `data.txt` 文件即可，脚本会自动生成带日期的图片
3. **卡片数量**：最多支持 3 个项目分组（卡片），超出部分会被忽略
4. **平台名称**：使用标准名称（M端、P端、线下），脚本会自动处理"线下端"等变体
5. **推进率一致性**：建议确保分项的推进率与总体推进率逻辑一致

## 示例输出

运行脚本后，控制台会输出：

```
================================================================================
【视图 A：M端 & P端 & 线下】
================================================================================

Q3 季度计划:
  总计划: 30, 已启动: 24, 推进率: 80%
  - M端: 已启动 9 / 计划 10 (90%)
  - P端: 已启动 5 / 计划 7 (71%)
  - 线下: 已启动 10 / 计划 13 (77%)

1月计划:
  总计划: 33, 已启动: 33, 推进率: 100%
  - M端: 已启动 10 / 计划 10 (100%)
  - P端: 已启动 10 / 计划 10 (100%)
  - 线下: 已启动 13 / 计划 13 (100%)

迭代0119:
  总计划: 57, 已启动: 57, 推进率: 100%
  - M端: 已启动 17 / 计划 17 (100%)
  - P端: 已启动 17 / 计划 17 (100%)
  - 线下: 已启动 23 / 计划 23 (100%)

================================================================================
【视图 B：已剔除 M端】
================================================================================

Q3 季度计划:
  总计划: 20, 已启动: 15, 推进率: 75%
  - P端: 已启动 5 / 计划 7 (71%)
  - 线下: 已启动 10 / 计划 13 (77%)

1月计划:
  总计划: 23, 已启动: 23, 推进率: 100%
  - P端: 已启动 10 / 计划 10 (100%)
  - 线下: 已启动 13 / 计划 13 (100%)

迭代0119:
  总计划: 40, 已启动: 40, 推进率: 100%
  - P端: 已启动 17 / 计划 17 (100%)
  - 线下: 已启动 23 / 计划 23 (100%)

================================================================================

✓ 图片生成成功！
  视图 A (M端 & P端 & 线下): /path/to/output/周报_视图A_2025-01-17.svg
  视图 B (剔除 M端): /path/to/output/周报_视图B_2025-01-17.svg

提示：
  - 生成的文件为 SVG 格式（矢量图）
  - 可以在浏览器中直接打开查看
  - 可以使用在线工具转换为 PNG：https://cloudconvert.com/svg-to-png
```

## 常见问题

### Q1: 为什么生成的图片是SVG格式而不是PNG？

A: SVG（矢量图）格式的优点：
- 文件体积小
- 无限缩放不失真
- 可以在任何浏览器中直接打开
- 容易编辑和修改

如需PNG格式，请参考"转换为PNG格式"章节。

### Q2: 数据中的推进率如何计算？

A: 
- 如果明确指定了推进率，使用指定值
- 如果未指定，系统会根据已启动数/计划数自动计算
- 如果总体推进率为100%，未指定推进率的分项默认为100%

### Q3: 如何添加新的项目分组？

A: 直接在 `data.txt` 中添加新的分组：

```
【新分组名称】
计划名已排长线计划总计XX项，已启动XX项，推进率XX%；
M端XX项，已启动XX项，推进率XX%；
P端XX项，已启动XX项，推进率XX%；
线下端XX项，已启动XX项，推进率XX%；
```

注意：最多支持3个分组，超出部分不会显示。

### Q4: 标题是如何提取的？

A: 脚本会自动从第一行中提取：
- 季度：Q1, Q2, Q3, Q4 → "Q1 季度计划"
- 月份：1月, 2月, ..., 12月 → "1月计划"
- 迭代：4位数字（如0119）→ "迭代0119"

如果无法提取，会使用分组名称作为标题。

### Q5: "线下端"和"线下"有什么区别？

A: 两者是等价的，脚本会自动将"线下端"统一显示为"线下"。

## 技术支持

如有问题，请检查：
1. Python 版本 >= 3.7
2. data.txt 文件格式正确
3. 使用 UTF-8 编码保存文件
