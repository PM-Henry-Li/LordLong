[mypy]
# Python 版本
python_version = 3.10

# 基础配置
warn_return_any = True
warn_unused_configs = True
warn_redundant_casts = True
warn_unused_ignores = True

# 严格模式配置（渐进式启用）
disallow_untyped_defs = False
disallow_any_unimported = False
disallow_any_expr = False
disallow_any_decorated = False
disallow_any_explicit = False
disallow_any_generics = False
disallow_subclassing_any = False

# 可选值检查
no_implicit_optional = True
strict_optional = True

# 错误处理
show_error_codes = True
show_column_numbers = True
show_error_context = True
pretty = True

# 导入检查
ignore_missing_imports = True
follow_imports = normal

# 缓存
cache_dir = .mypy_cache
sqlite_cache = True

# 排除的目录和文件
exclude = (?x)(^\.venv/|^venv/|^env/|^build/|^dist/|^\.eggs/|^\.tox/|^__pycache__/|^\.pytest_cache/|^\.mypy_cache/|^output/|^test_output/|^htmlcov/|^logs/|^debug_.*\.py$|^check_type_annotations\.py$|^test_log_api\.py$)

# 核心模块严格检查
[mypy-src.core.config_manager]
disallow_untyped_defs = True
warn_return_any = True
warn_unreachable = True

[mypy-src.core.logger]
disallow_untyped_defs = True
warn_return_any = True
warn_unreachable = True

[mypy-src.core.cache_manager]
disallow_untyped_defs = True
warn_return_any = True
warn_unreachable = True

[mypy-src.core.rate_limiter]
disallow_untyped_defs = True
warn_return_any = True
warn_unreachable = True

[mypy-src.core.api_handler]
disallow_untyped_defs = True
warn_return_any = True
disable_error_code = arg-type,return-value,misc,call-arg

[mypy-src.core.retry_handler]
disallow_untyped_defs = True
warn_return_any = True

[mypy-src.core.exceptions]
disallow_untyped_defs = True
warn_return_any = True

# 日志相关模块（包含复杂的第三方库交互）
[mypy-src.core.log_collector]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = union-attr,arg-type,assignment,var-annotated,return-value

[mypy-src.core.log_alerting]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = assignment,union-attr,attr-defined,operator,var-annotated

# 主要业务模块（宽松检查）
[mypy-src.content_generator]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = assignment,attr-defined,no-any-return,return

[mypy-src.image_generator]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = assignment,arg-type,return-value,no-any-return,union-attr,var-annotated,call-overload

[mypy-src.async_image_service]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = assignment,arg-type

# 图片处理模块（PIL 相关）
[mypy-src.template_image_generator]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = assignment,arg-type,return-value,var-annotated

[mypy-src.image_pipeline]
disallow_untyped_defs = False
warn_return_any = False

[mypy-src.image_resource_manager]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = assignment

# Web 相关模块
[mypy-web_app]
disallow_untyped_defs = False
warn_return_any = False

[mypy-src.web.blueprints.api]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = return-value,arg-type

[mypy-src.web.error_handlers]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = assignment

# 其他业务模块
[mypy-src.xiaohongshu_scraper]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = union-attr,attr-defined

[mypy-src.content_organizer]
disallow_untyped_defs = False
warn_return_any = False
disable_error_code = return-value,arg-type,union-attr

# 第三方库忽略规则
[mypy-openpyxl.*]
ignore_missing_imports = True

[mypy-PIL.*]
ignore_missing_imports = True

[mypy-selenium.*]
ignore_missing_imports = True

[mypy-flask_socketio.*]
ignore_missing_imports = True

[mypy-flask_cors.*]
ignore_missing_imports = True

[mypy-aiohttp.*]
ignore_missing_imports = True

[mypy-openai.*]
ignore_missing_imports = True

[mypy-requests.*]
ignore_missing_imports = True

[mypy-pydantic.*]
ignore_missing_imports = True

# 测试文件（宽松检查）
[mypy-tests.*]
disallow_untyped_defs = False
ignore_errors = False
warn_return_any = False
