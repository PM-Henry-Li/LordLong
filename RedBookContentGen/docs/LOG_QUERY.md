# 日志查询功能文档

## 概述

日志查询功能提供了一个 Web 界面，用于查看、搜索和分析应用程序的日志记录。

## 功能特性

### 1. 日志统计

在页面顶部显示以下统计信息：
- 总日志数：所有日志记录的总数
- 错误数：ERROR 和 CRITICAL 级别的日志数量
- 警告数：WARNING 级别的日志数量
- 今日日志：今天产生的日志数量

### 2. 日志过滤

支持多种过滤条件：
- **日志级别**：DEBUG、INFO、WARNING、ERROR、CRITICAL
- **日志来源**：按模块名称过滤（如 content_generator、image_generator 等）
- **时间范围**：指定开始时间和结束时间
- **关键词搜索**：在日志消息中搜索关键词

### 3. 日志展示

每条日志记录显示以下信息：
- 日志级别（带颜色标识）
- 时间戳
- 日志来源（模块名称）
- 日志消息
- 详细信息（模块、函数、行号、线程）
- 异常信息（如果有）

### 4. 分页浏览

- 每页显示 50 条日志
- 支持翻页浏览
- 显示总页数和当前页码

## 使用方法

### 访问日志查询页面

1. 启动 Web 应用：
   ```bash
   python web_app.py
   ```

2. 在浏览器中访问：
   ```
   http://localhost:8080/logs
   ```

3. 或者从主页点击右上角的"日志查询"链接

### 查询日志

1. **基本查询**：
   - 直接点击"查询"按钮，查看所有日志

2. **按级别过滤**：
   - 选择日志级别（如 ERROR）
   - 点击"查询"按钮

3. **按来源过滤**：
   - 选择日志来源（如 content_generator）
   - 点击"查询"按钮

4. **按时间范围过滤**：
   - 设置开始时间和结束时间
   - 点击"查询"按钮

5. **关键词搜索**：
   - 在搜索框中输入关键词
   - 按回车或点击"查询"按钮

6. **组合过滤**：
   - 可以同时使用多个过滤条件
   - 点击"查询"按钮

7. **重置过滤**：
   - 点击"重置"按钮清除所有过滤条件

## API 接口

### 1. 搜索日志

**端点**: `GET /api/logs/search`

**查询参数**:
- `page`: 页码（默认 1）
- `page_size`: 每页数量（默认 50）
- `level`: 日志级别过滤
- `logger`: 日志来源过滤
- `start_time`: 开始时间（ISO 格式）
- `end_time`: 结束时间（ISO 格式）
- `keyword`: 关键词搜索

**响应示例**:
```json
{
  "success": true,
  "logs": [
    {
      "timestamp": "2026-02-13T09:32:54.336191",
      "level": "INFO",
      "logger": "image_generator",
      "message": "缓存已启用",
      "module": "image_generator",
      "function": "__init__",
      "line": 123,
      "thread": 12345,
      "thread_name": "MainThread"
    }
  ],
  "total": 100,
  "page": 1,
  "page_size": 50
}
```

### 2. 获取日志统计

**端点**: `GET /api/logs/stats`

**响应示例**:
```json
{
  "success": true,
  "stats": {
    "total": 1000,
    "error": 10,
    "warning": 50,
    "today": 200
  }
}
```

### 3. 获取日志来源列表

**端点**: `GET /api/logs/loggers`

**响应示例**:
```json
{
  "success": true,
  "loggers": [
    "content_generator",
    "image_generator",
    "web_app",
    "template_image_generator"
  ]
}
```

## 日志级别说明

- **DEBUG**: 调试信息，用于开发和调试
- **INFO**: 一般信息，记录正常的操作流程
- **WARNING**: 警告信息，表示潜在的问题
- **ERROR**: 错误信息，表示操作失败但程序可以继续运行
- **CRITICAL**: 严重错误，表示程序可能无法继续运行

## 注意事项

1. **日志文件位置**：
   - 默认日志文件：`logs/app.log`
   - 可以在配置文件中修改日志文件路径

2. **日志格式**：
   - 日志文件使用 JSON 格式，每行一个 JSON 对象
   - 旧格式的日志行会被自动跳过

3. **性能考虑**：
   - 日志文件较大时，查询可能需要一些时间
   - 建议使用过滤条件缩小查询范围
   - 考虑定期清理旧日志文件

4. **时间格式**：
   - 时间使用 ISO 8601 格式
   - 示例：`2026-02-13T09:32:54.336191`

## 故障排查

### 问题：无法访问日志查询页面

**解决方法**：
1. 确认 Web 应用已启动
2. 检查端口 8080 是否被占用
3. 查看控制台是否有错误信息

### 问题：查询结果为空

**解决方法**：
1. 检查日志文件是否存在（`logs/app.log`）
2. 确认过滤条件是否过于严格
3. 尝试点击"重置"按钮清除所有过滤条件

### 问题：日志显示不完整

**解决方法**：
1. 检查日志文件格式是否正确（JSON 格式）
2. 查看浏览器控制台是否有错误信息
3. 尝试刷新页面

## 未来改进

- [ ] 支持日志导出（CSV、JSON）
- [ ] 支持实时日志流（WebSocket）
- [ ] 支持日志可视化图表
- [ ] 支持日志告警规则配置
- [ ] 支持多个日志文件查询
- [ ] 支持日志归档和压缩
