# RedBookContentGen 项目改进任务列表

## 📊 项目进度概览

- ✅ **阶段一：基础架构** - 已完成 100%
- ✅ **阶段二：性能优化** - 已完成 95%
- ✅ **阶段三：代码质量** - 已完成 100%
- ✅ **阶段四：安全增强** - 已完成 67% (任务 10-11 完成，任务 12 可选)
- 🔄 **阶段五：用户体验** - 进行中 33% (任务 13 已完成，任务 14 部分完成)
- ⏳ **阶段六：功能增强** - 未开始
- ⏳ **阶段七：部署与运维** - 未开始

## 🎯 当前重点

根据项目现状，建议优先完成以下任务：

1. **完成错误处理优化**（任务 14.2-14.3）- 提升用户体验
2. **实现批量处理功能**（任务 15）- 提高生产效率
3. **完善 API 文档**（任务 21.1）- 降低使用门槛
4. **容器化部署**（任务 19）- 简化部署流程

---

## ✅ 阶段一：基础架构（已完成）

### 1. 统一配置管理 ✅
- [x] 1.1 创建 ConfigManager 类
  - [x] 1.1.1 实现配置加载逻辑（支持JSON、YAML、环境变量）
  - [x] 1.1.2 实现配置优先级管理
  - [x] 1.1.3 实现配置验证功能
  - [x] 1.1.4 添加配置热重载支持
  - _验收标准：✅ 支持多层配置覆盖，✅ 配置验证，✅ 热重载_
  - _相关文件：src/core/config_manager.py, src/core/config_schema.py_
  - _文档：docs/CONFIG.md, docs/config_migration_guide.md_

- [x] 1.2 创建配置模式（Schema）
  - [x] 1.2.1 定义API配置模式
  - [x] 1.2.2 定义缓存配置模式
  - [x] 1.2.3 定义日志配置模式
  - [x] 1.2.4 定义速率限制配置模式
  - _验收标准：✅ 完整的配置模式定义，✅ 类型检查_
  - _相关文件：src/core/config_schema.py_

- [x] 1.3 迁移现有配置
  - [x] 1.3.1 迁移 content_generator.py 配置
  - [x] 1.3.2 迁移 image_generator.py 配置
  - [x] 1.3.3 迁移 web_app.py 配置
  - [x] 1.3.4 更新配置文档
  - _验收标准：✅ 所有模块使用 ConfigManager，✅ 向后兼容_
  - _文档：docs/CONFIG_MIGRATION_GUIDE.md_

### 2. 日志系统 ✅
- [x] 2.1 创建 Logger 模块
  - [x] 2.1.1 实现结构化日志记录器
  - [x] 2.1.2 实现日志格式化（JSON格式）
  - [x] 2.1.3 实现日志文件轮转
  - [x] 2.1.4 添加日志上下文管理
  - _验收标准：✅ 结构化日志，✅ JSON格式，✅ 文件轮转_
  - _相关文件：src/core/logger.py_
  - _文档：docs/LOGGER.md_

- [x] 2.2 替换现有 print 语句
  - [x] 2.2.1 替换 content_generator.py 中的 print
  - [x] 2.2.2 替换 image_generator.py 中的 print
  - [x] 2.2.3 替换 web_app.py 中的 print
  - [x] 2.2.4 替换其他模块中的 print
  - _验收标准：✅ 所有模块使用 Logger，✅ 统一日志格式_

- [x] 2.3 添加日志监控
  - [x] 2.3.1 集成日志收集工具
  - [x] 2.3.2 配置日志告警规则
  - [x] 2.3.3 创建日志查询界面
  - _验收标准：✅ 日志收集，✅ 告警规则，✅ Web查询界面_
  - _相关文件：src/core/log_collector.py, src/core/log_alerting.py, templates/logs.html_
  - _文档：docs/LOG_QUERY.md, docs/LOG_ALERTING.md_

### 3. 单元测试框架 ✅
- [x] 3.1 搭建测试环境
  - [x] 3.1.1 安装 pytest 和相关插件
  - [x] 3.1.2 配置 pytest.ini
  - [x] 3.1.3 创建测试目录结构
  - [x] 3.1.4 配置测试覆盖率工具
  - _验收标准：✅ pytest 配置，✅ 测试目录结构，✅ 覆盖率工具_
  - _相关文件：pytest.ini, .coveragerc, tests/_
  - _文档：docs/TESTING.md_

- [x] 3.2 编写测试工具类
  - [x] 3.2.1 创建 Mock 工具（使用 pytest fixtures）
  - [x] 3.2.2 创建测试数据生成器（在 conftest.py 中）
  - [x] 3.2.3 创建测试断言辅助函数
  - _验收标准：✅ 测试工具类，✅ Fixtures_
  - _相关文件：tests/conftest.py, tests/fixtures/_

- [x] 3.3 编写基础测试
  - [x] 3.3.1 测试 ConfigManager
  - [x] 3.3.2 测试 Logger
  - [x] 3.3.3 测试工具函数
  - _验收标准：✅ 核心模块测试覆盖_
  - _相关文件：tests/unit/test_config_manager.py, tests/unit/test_logger.py_

---

## ✅ 阶段二：性能优化（已完成 95%）

### 4. 并行图片生成 ✅
- [x] 4.1 重构图片生成逻辑
  - [x] 4.1.1 提取图片生成核心函数
  - [x] 4.1.2 实现异步图片生成接口
  - [x] 4.1.3 添加并发控制（Semaphore）
  - [x] 4.1.4 实现错误隔离机制
  - _验收标准：✅ 异步生成，✅ 并发控制，✅ 错误隔离_
  - _相关文件：src/async_image_service.py_
  - _文档：docs/ASYNC_IMAGE_GENERATION.md_

- [x] 4.2 优化 API 调用
  - [x] 4.2.1 使用 aiohttp 替代 requests
  - [x] 4.2.2 实现连接池管理
  - [x] 4.2.3 添加超时控制
  - [x] 4.2.4 实现智能重试
  - _验收标准：✅ 异步HTTP，✅ 连接池，✅ 超时控制_

- [x] 4.3 性能测试
  - [x] 4.3.1 编写性能测试用例
  - [x] 4.3.2 对比串行和并行性能
  - [x] 4.3.3 优化并发参数
  - [x] 4.3.4 生成性能报告
  - _验收标准：✅ 性能提升 60%+_
  - _相关文件：tests/test_image_generation_performance.py_
  - _文档：PERFORMANCE_REPORT.md_

### 5. 缓存机制 ✅
- [x] 5.1 创建 CacheManager
  - [x] 5.1.1 实现内存缓存（LRU）
  - [x] 5.1.2 实现文件缓存
  - [x] 5.1.3 实现缓存键生成逻辑
  - _验收标准：✅ LRU缓存，✅ 文件缓存，✅ 缓存键生成_
  - _相关文件：src/core/cache_manager.py_
  - _文档：docs/CACHE_MANAGER.md, docs/FILE_CACHE.md_
  - _注：Redis 缓存为可选功能，暂不实现_

- [x] 5.2 集成缓存到服务
  - [x] 5.2.1 为内容生成添加缓存
  - [x] 5.2.2 为图片生成添加缓存
  - [x] 5.2.3 实现缓存失效策略（TTL）
  - [x] 5.2.4 添加缓存统计
  - _验收标准：✅ 内容缓存，✅ 图片缓存，✅ TTL策略_
  - _文档：docs/CACHE_USAGE.md_

- [ ] 5.3 缓存管理（优先级：低）
  - [~] 5.3.1 实现缓存清理任务
  - [~] 5.3.2 添加缓存监控
  - [~] 5.3.3 创建缓存管理界面
  - _说明：基础缓存功能已完成，管理界面为增强功能_

### 6. API速率限制 ✅
- [x] 6.1 创建 RateLimiter
  - [x] 6.1.1 实现令牌桶算法
  - [x] 6.1.2 支持多种限流策略
  - [x] 6.1.3 添加限流统计
  - _验收标准：✅ 令牌桶算法，✅ 多策略支持_
  - _相关文件：src/core/rate_limiter.py_
  - _文档：docs/RATE_LIMITER.md, docs/RATE_LIMITER_STRATEGIES.md_
  - _注：分布式限流为可选功能，暂不实现_

- [x] 6.2 集成到 API 调用
  - [x] 6.2.1 为 OpenAI API 添加限流
  - [x] 6.2.2 为图片生成 API 添加限流
  - [x] 6.2.3 实现限流等待逻辑
  - _验收标准：✅ API限流，✅ 自动等待_
  - _文档：docs/CONTENT_GENERATOR_RATE_LIMIT.md, docs/IMAGE_GENERATOR_RATE_LIMIT.md_

- [ ] 6.3 Web 接口限流（优先级：中）
  - [~] 6.3.1 安装 flask-limiter
  - [~] 6.3.2 配置接口限流规则
  - [~] 6.3.3 实现限流响应
  - [~] 6.3.4 添加限流监控
  - _说明：API层限流已完成，Web层限流为增强功能_

---

## 🔄 阶段三：代码质量（进行中 30%）

### 7. 代码重构（优先级：高）✅
- [x] 7.1 重构 content_generator.py
  - [x] 7.1.1 拆分 generate_content 函数（当前约 100+ 行）
    - 提取提示词构建逻辑
    - 提取 API 调用逻辑
    - 提取结果解析逻辑
  - [x] 7.1.2 提取重复代码
    - 统一错误处理模式
    - 统一重试逻辑
  - [x] 7.1.3 简化条件逻辑
    - 减少嵌套层级
    - 使用早返回模式
  - [x] 7.1.4 优化错误处理
    - 使用自定义异常类
    - 添加更详细的错误信息
  - _验收标准：✅ 单个函数不超过 50 行_
  - _相关文件：src/content_generator.py_
  - _需求引用：需求 3.3.1（代码重构）_

- [x] 7.2 重构 image_generator.py
  - [x] 7.2.1 拆分 add_text_overlay 函数（当前约 200+ 行）
    - 提取文字换行逻辑
    - 提取文字绘制逻辑
    - 提取图片处理逻辑
  - [x] 7.2.2 提取文字处理逻辑
    - 创建 TextProcessor 类
    - 统一文字处理接口
  - [x] 7.2.3 简化图片生成流程
    - 使用责任链模式
    - 分离生成和后处理
  - [x] 7.2.4 优化资源管理
    - 使用上下文管理器
    - 确保资源正确释放
  - _验收标准：✅ 单个函数不超过 50 行_
  - _相关文件：src/image_generator.py_
  - _需求引用：需求 3.3.1（代码重构）_

- [x] 7.3 重构 web_app.py
  - [x] 7.3.1 提取业务逻辑到服务层
    - 创建 ContentService
    - 创建 ImageService
    - 路由只负责请求响应
  - [x] 7.3.2 简化路由处理
    - 使用蓝图组织路由
    - 统一请求验证
  - [x] 7.3.3 统一错误响应
    - 创建错误响应格式
    - 使用错误处理装饰器
  - [x] 7.3.4 优化请求验证
    - 使用 Pydantic 模型
    - 自动验证和序列化
  - _验收标准：✅ 路由函数不超过 30 行_
  - _相关文件：web_app.py_
  - _需求引用：需求 3.3.1（代码重构）_

- [x] 7.4 代码质量检查
  - [x] 7.4.1 运行 pylint 检查
    - 修复所有错误
    - 修复高优先级警告
  - [x] 7.4.2 运行 flake8 检查
    - 修复代码风格问题
    - 统一代码格式
  - [x] 7.4.3 使用 black 格式化代码
    - 配置 black
    - 格式化所有 Python 文件
  - [x] 7.4.4 修复所有警告
    - 目标：pylint 评分 > 8.0
    - 目标：flake8 无警告
  - _验收标准：✅ pylint 评分 > 8.0，✅ flake8 无警告_
  - _需求引用：需求 3.3.1（代码重构）_

### 8. 类型注解（优先级：中）✅
- [x] 8.1 添加类型注解
  - [x] 8.1.1 为 content_generator.py 添加类型注解
    - 所有公共方法
    - 所有私有方法
    - 复杂的局部变量
  - [x] 8.1.2 为 image_generator.py 添加类型注解
    - 所有公共方法
    - 所有私有方法
    - PIL 相关类型
  - [x] 8.1.3 为 web_app.py 添加类型注解
    - 所有路由函数
    - 所有辅助函数
    - Flask 相关类型
  - [x] 8.1.4 为其他模块添加类型注解
    - src/core/ 下所有模块
    - 工具函数模块
  - _验收标准：✅ 类型注解覆盖率 > 80%_
  - _需求引用：需求 3.3.2（类型注解）_

- [x] 8.2 类型检查
  - [x] 8.2.1 配置 mypy
    - 创建 mypy.ini
    - 配置严格模式
    - 配置忽略规则
  - [x] 8.2.2 运行 mypy 检查
    - 修复类型错误
    - 添加类型忽略注释（必要时）
  - [x] 8.2.3 修复类型错误
    - 目标：mypy 检查通过率 100%
  - [x] 8.2.4 集成到 CI/CD
    - 添加 mypy 检查步骤
    - 类型检查失败则构建失败
  - _验收标准：✅ mypy 检查通过率 100%_
  - _需求引用：需求 3.3.2（类型注解）_

### 9. 单元测试补充（优先级：高）
- [ ] 9.1 补充 content_generator 测试
  - [x] 9.1.1 测试内容生成功能
    - 测试正常生成流程
    - 测试不同输入长度
    - 测试不同风格参数
  - [x] 9.1.2 测试错误处理
    - 测试 API 错误
    - 测试网络错误
    - 测试超时错误
  - [x] 9.1.3 测试重试机制
    - 测试重试次数
    - 测试重试间隔
    - 测试最终失败
  - [x] 9.1.4 测试缓存集成
    - 测试缓存命中
    - 测试缓存未命中
    - 测试缓存失效
  - _验收标准：✅ 测试覆盖率 > 70%_
  - _相关文件：tests/unit/test_content_generator_integration.py_
  - _需求引用：需求 3.3.3（单元测试）_

- [ ] 9.2 补充 image_generator 测试
  - [x] 9.2.1 测试图片生成核心功能
    - 编写 API 模式生成测试（使用 Mock）
    - 编写模板模式生成测试
    - 测试不同尺寸参数
    - _相关文件：tests/unit/test_image_generator.py_
    - _需求引用：需求 3.3.3（单元测试）_
  
  - [x] 9.2.2 测试文字叠加功能
    - 测试中文文字换行逻辑
    - 测试文字截断边界情况
    - 测试特殊字符处理（emoji、标点）
    - _相关文件：tests/test_text_overlay.py（已存在，需补充）_
    - _需求引用：需求 3.3.3（单元测试）_
  
  - [~] 9.2.3 测试并行生成机制
    - 测试并发控制（Semaphore）
    - 测试单个任务失败不影响其他任务
    - 对比串行和并行性能
    - _相关文件：tests/test_image_generation_performance.py（已存在）_
    - _需求引用：需求 3.2.1（并行图片生成）_
  
  - [~] 9.2.4 测试降级策略
    - 测试 API 失败时降级到模板模式
    - 测试模板模式失败时的处理
    - 测试无文字叠加的降级
    - _相关文件：tests/unit/test_image_generator.py_
    - _需求引用：需求 3.2.1（并行图片生成）_
  
  - _目标：测试覆盖率 > 70%_

- [ ] 9.3 补充 web_app 测试
  - [~] 9.3.1 测试 REST API 接口
    - 测试 POST /api/generate_content 接口
    - 测试 POST /api/generate_images 接口
    - 测试 GET /api/search 接口
    - 测试请求参数验证
    - _相关文件：tests/unit/test_web_app.py（新建）_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [~] 9.3.2 测试 WebSocket 通信
    - 测试进度事件推送
    - 测试客户端连接管理
    - 测试异常断开处理
    - _相关文件：tests/unit/test_websocket.py（新建）_
    - _需求引用：需求 3.5.1（进度反馈）_
  
  - [~] 9.3.3 测试错误响应格式
    - 测试 400 错误（输入验证失败）
    - 测试 500 错误（服务器内部错误）
    - 测试错误响应 JSON 格式
    - _相关文件：tests/unit/test_web_app.py_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - [~] 9.3.4 测试速率限制功能
    - 测试接口速率限制触发
    - 测试限流响应（429 状态码）
    - 测试限流恢复机制
    - _相关文件：tests/unit/test_rate_limit.py（新建）_
    - _需求引用：需求 3.2.3（API速率限制）_
  
  - _目标：测试覆盖率 > 70%_

- [ ] 9.4 编写集成测试
  - [~] 9.4.1 测试完整生成流程
    - 测试从输入到输出的端到端流程
    - 验证数据在各模块间的流转
    - 验证最终结果的正确性
    - _相关文件：tests/integration/test_full_generation_flow.py（新建）_
    - _需求引用：需求 3.3.3（单元测试）_
  
  - [~] 9.4.2 测试批量生成场景
    - 测试批量输入处理
    - 测试批量输出格式
    - 测试批量生成性能
    - _相关文件：tests/integration/test_batch_generation.py（新建）_
    - _需求引用：需求 3.5.3（批量处理）_
  
  - [~] 9.4.3 测试并发场景
    - 模拟多用户同时请求
    - 测试资源竞争情况
    - 测试性能稳定性
    - _相关文件：tests/integration/test_concurrent_requests.py（新建）_
    - _需求引用：需求 3.2.1（并行图片生成）_
  
  - [~] 9.4.4 测试异常恢复
    - 模拟网络中断后恢复
    - 模拟 API 错误后重试
    - 验证数据一致性
    - _相关文件：tests/integration/test_error_recovery.py（新建）_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - _目标：集成测试覆盖主要流程_

---

## ⏳ 阶段四：安全增强（未开始）

### 10. 敏感信息保护（优先级：高）✅
- [x] 10.1 迁移 API Key 到环境变量
  - [x] 10.1.1 创建 .env.example 模板文件
    - 定义所有必需的环境变量
    - 添加变量说明和示例值
    - 标注必填和可选变量
    - _相关文件：.env.example_
    - _需求引用：需求 3.4.1（敏感信息保护）_
  
  - [x] 10.1.2 修改 ConfigManager 支持环境变量
    - 优先从环境变量读取 API Key
    - 支持 ${ENV_VAR} 语法引用环境变量
    - 启动时验证必需的环境变量
    - _相关文件：src/core/config_manager.py_
    - _设计引用：设计 3.1（敏感信息保护）_
  
  - [x] 10.1.3 更新配置文档
    - 更新 CONFIG.md 添加环境变量说明
    - 添加安全最佳实践章节
    - 提供配置迁移指南
    - _相关文件：docs/CONFIG.md, docs/ENV_VAR_REFERENCE.md_
    - _需求引用：需求 3.4.1（敏感信息保护）_
  
  - [x] 10.1.4 添加配置验证
    - 检查 config.json 是否包含明文 API Key
    - 启动时警告不安全的配置
    - 提供配置检查脚本
    - _相关文件：scripts/check_config_security.py_
    - _需求引用：需求 3.4.1（敏感信息保护）_
  
  - _验收标准：✅ config.json 不包含明文密钥，所有敏感信息通过环境变量配置_

- [x] 10.2 实现日志脱敏
  - [x] 10.2.1 识别需要脱敏的字段
    - API Key 模式（sk-xxx, dashscope-xxx）
    - 密码字段
    - 用户敏感信息（手机号、邮箱）
    - _相关文件：src/core/logger.py, docs/SENSITIVE_DATA_PATTERNS.md_
    - _需求引用：需求 3.4.1（敏感信息保护）_
  
  - [x] 10.2.2 实现脱敏函数
    - 使用正则表达式匹配敏感信息
    - 实现部分隐藏（如：sk-***abc）
    - 支持自定义脱敏规则
    - _相关文件：src/core/logger.py_
    - _设计引用：设计 3.1（敏感信息保护）_
  
  - [x] 10.2.3 集成到日志系统
    - 在日志输出前自动脱敏
    - 配置脱敏规则
    - 确保性能影响最小
    - _相关文件：src/core/logger.py_
    - _需求引用：需求 3.4.1（敏感信息保护）_
  
  - [x] 10.2.4 测试脱敏效果
    - 编写单元测试验证脱敏逻辑
    - 测试各种敏感信息格式
    - 进行安全审计
    - _相关文件：tests/unit/test_sensitive_data_masker.py, tests/unit/test_logger_masking_integration.py_
    - _需求引用：需求 3.4.1（敏感信息保护）_
  
  - _验收标准：✅ 日志中无敏感信息泄露_

- [ ] 10.3 创建 SecretManager（可选，优先级：低）
  - [ ] 10.3.1 实现加密/解密功能
    - 使用 cryptography 库
    - 实现 Fernet 加密
    - 密钥管理
    - _说明：此为增强功能，基础环境变量方案已足够_
  
  - [ ] 10.3.2 实现密钥轮转
    - 定期更新密钥
    - 平滑迁移
    - 审计日志
    - _说明：此为企业级功能，当前阶段可选_

### 11. 输入验证（优先级：高）✅
- [x] 11.1 创建 Pydantic 验证模型
  - [x] 11.1.1 定义内容生成请求模型
    - 创建 ContentGenerationRequest 类
    - 添加字段验证规则（长度、格式）
    - 添加自定义验证器
    - _相关文件：src/models/requests.py_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [x] 11.1.2 定义图片生成请求模型
    - 创建 ImageGenerationRequest 类
    - 验证提示词、尺寸、数量
    - 添加范围验证
    - _相关文件：src/models/requests.py_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [x] 11.1.3 定义搜索请求模型
    - 创建 SearchRequest 类
    - 验证查询参数
    - 添加分页参数验证
    - _相关文件：src/models/requests.py_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [x] 11.1.4 实现验证错误处理
    - 友好的错误消息（中文）
    - 错误字段定位
    - 建议修复方案
    - _相关文件：src/models/validation_errors.py_
    - _设计引用：设计 3.2（输入验证）_
  
  - _验收标准：✅ 所有 API 请求使用 Pydantic 模型验证_

- [x] 11.2 集成验证到 Web API
  - [x] 11.2.1 更新内容生成接口
    - 使用 ContentGenerationRequest 验证
    - 返回验证错误响应
    - 添加请求示例
    - _相关文件：web_app.py, tests/unit/test_content_generation_api.py_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [x] 11.2.2 更新图片生成接口
    - 使用 ImageGenerationRequest 验证
    - 验证文件上传（如果支持）
    - 添加请求示例
    - _相关文件：web_app.py_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [x] 11.2.3 更新搜索接口
    - 使用 SearchRequest 验证
    - 验证查询参数
    - 添加请求示例
    - _相关文件：web_app.py, tests/unit/test_search_api.py, docs/SEARCH_API.md_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [x] 11.2.4 编写验证测试
    - 测试正常输入
    - 测试边界值
    - 测试异常输入
    - _相关文件：tests/unit/test_request_models.py, tests/unit/test_input_validation.py_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - _验收标准：✅ 拒绝所有非法输入，返回友好错误提示_

- [~] 11.3 实现安全过滤（优先级：中）
  - [~] 11.3.1 实现 XSS 过滤
    - HTML 标签过滤
    - JavaScript 代码过滤
    - 事件处理器过滤
    - _相关文件：src/core/security.py（新建）_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [~] 11.3.2 实现路径遍历防护
    - 路径规范化
    - 白名单验证
    - 沙箱限制
    - _相关文件：src/core/security.py_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - [~] 11.3.3 添加安全测试
    - XSS 攻击测试
    - 路径遍历测试
    - SQL 注入测试（如果使用数据库）
    - _相关文件：tests/security/test_security_filters.py（新建）_
    - _需求引用：需求 3.4.2（输入验证）_
  
  - _验收标准：通过基本安全检查_

### 12. Web安全（优先级：低，可选）
- [ ] 12.1 HTTPS 支持
  - [ ] 12.1.1 生成 SSL 证书
    - 开发环境：自签名证书
    - 生产环境：Let's Encrypt
    - 证书管理文档
    - _相关文件：docs/HTTPS_SETUP.md（新建）_
  
  - [ ] 12.1.2 配置 HTTPS
    - Flask SSL 配置
    - Nginx 反向代理配置
    - 证书路径配置
    - _相关文件：nginx.conf（新建）_
  
  - [ ] 12.1.3 强制 HTTPS 重定向
    - HTTP 到 HTTPS 重定向
    - 添加 HSTS 头
    - 配置安全 Cookie
    - _相关文件：web_app.py_
  
  - _说明：此为生产环境功能，开发阶段可选_

- [ ] 12.2 安全响应头（优先级：中）
  - [ ] 12.2.1 添加 Content-Security-Policy
    - 限制脚本来源
    - 限制样式来源
    - 限制图片来源
    - _相关文件：web_app.py_
  
  - [ ] 12.2.2 添加其他安全头
    - X-Frame-Options: DENY
    - X-Content-Type-Options: nosniff
    - X-XSS-Protection: 1; mode=block
    - _相关文件：web_app.py_
  
  - [ ] 12.2.3 测试安全头
    - 使用 securityheaders.com 检查
    - 使用 Mozilla Observatory 检查
    - 修复评分问题
    - _相关文件：docs/SECURITY_HEADERS.md（新建）_
  
  - _验收标准：安全评分 B+ 以上_

- [ ] 12.3 CSRF 保护（优先级：低）
  - [ ] 12.3.1 安装 flask-wtf
  - [ ] 12.3.2 配置 CSRF 保护
  - [ ] 12.3.3 更新前端代码
  - [ ] 12.3.4 测试 CSRF 防护
  - _说明：当前为单用户工具，CSRF 风险较低_

---

## ⏳ 阶段五：用户体验（未开始）

### 13. 进度反馈（优先级：高）⭐⭐⭐
- [x] 13.1 实现 WebSocket 进度推送
  - [x] 13.1.1 安装和配置 flask-socketio
    - 安装 flask-socketio 和 python-socketio
    - 配置 SocketIO 实例
    - 设置 CORS 策略
    - 配置消息队列（可选，用于多进程）
    - _相关文件：web_app.py, requirements.txt_
    - _需求引用：需求 3.5.1（进度反馈）_
    - _性能目标：消息延迟 < 100ms_
  
  - [x] 13.1.2 实现进度事件推送
    - 定义进度事件格式（JSON）
    - 实现进度计算逻辑（各阶段权重分配）
    - 在关键步骤推送进度更新
    - 添加进度状态枚举（started, generating_content, generating_image, completed, failed, cancelled）
    - _相关文件：web_app.py, src/content_generator.py, src/image_generator.py_
    - _设计引用：设计 4.1（进度反馈）_
    - _测试要求：单元测试覆盖进度计算逻辑_
  
  - [x] 13.1.3 实现任务取消功能
    - 处理客户端取消信号
    - 清理正在执行的任务（停止 API 调用）
    - 释放占用的资源（关闭连接、清理临时文件）
    - 更新任务状态为 cancelled
    - _相关文件：web_app.py_
    - _需求引用：需求 3.5.1（进度反馈）_
    - _测试要求：验证资源正确释放_
  
  - [x] 13.1.4 添加连接管理
    - 处理连接建立和断开
    - 实现心跳检测（每 30 秒）
    - 支持断线重连（客户端自动重连）
    - 恢复任务状态（重连后继续显示进度）
    - _相关文件：web_app.py_
    - _需求引用：需求 3.5.1（进度反馈）_
    - _测试要求：模拟网络中断测试重连_
  
  - _验收标准：✅ 实时进度反馈（延迟 < 100ms），✅ 支持任务取消，✅ 断线重连_

- [x] 13.2 前端进度显示集成
  - [x] 13.2.1 实现进度条组件
    - 设计进度条样式（CSS）
    - 添加动画效果
    - 显示状态文字
    - _相关文件：static/css/style.css, static/js/progress.js（新建）_
    - _需求引用：需求 3.5.1（进度反馈）_
  
  - [x] 13.2.2 连接 WebSocket 并显示进度
    - 建立 WebSocket 连接
    - 接收进度事件
    - 更新进度条 UI
    - _相关文件：static/js/progress.js_
    - _需求引用：需求 3.5.1（进度反馈）_
  
  - [x] 13.2.3 显示预计剩余时间
    - 计算剩余时间
    - 格式化时间显示（如：2分30秒）
    - 动态更新
    - _相关文件：static/js/progress.js_
    - _需求引用：需求 3.5.1（进度反馈）_
  
  - [x] 13.2.4 添加取消按钮
    - 设计取消按钮样式
    - 发送取消请求
    - 显示确认对话框
    - _相关文件：templates/index.html, static/js/progress.js_
    - _需求引用：需求 3.5.1（进度反馈）_
  
  - _验收标准：友好的进度显示，用户可随时取消_

- [x] 13.3 测试进度反馈功能
  - [x] 13.3.1 测试进度推送准确性
    - 验证进度百分比计算
    - 测试各阶段进度更新
    - 测试性能影响
    - _相关文件：tests/unit/test_websocket.py_
  
  - [x] 13.3.2 测试任务取消
    - 测试取消功能
    - 验证资源清理
    - 测试状态一致性
    - _相关文件：tests/unit/test_websocket.py_
  
  - [x] 13.3.3 测试断线重连
    - 模拟网络中断
    - 测试自动重连
    - 验证状态恢复
    - _相关文件：tests/integration/test_websocket_reconnect.py（新建）_
  
  - _验收标准：稳定可靠的实时通信_

### 14. 错误处理优化（优先级：高）⭐⭐⭐
- [x] 14.1 创建统一错误类型 ✅
  - [x] 14.1.1 定义错误基类
    - 创建 AppError 基类
    - 定义错误码枚举（INVALID_INPUT, API_ERROR, TIMEOUT, etc.）
    - 定义错误消息模板（中文）
    - 添加错误严重级别（ERROR, WARNING, INFO）
    - _相关文件：src/core/exceptions.py_
    - _需求引用：需求 3.5.2（错误处理）_
    - _设计引用：设计 4.2（错误分类）_
  
  - [x] 14.1.2 定义用户错误类
    - ValidationError（输入验证错误）
    - InputError（输入格式错误）
    - AuthenticationError（认证错误）
    - 每个错误类包含错误码、消息、修复建议
    - _相关文件：src/core/exceptions.py_
    - _设计引用：设计 4.2（错误处理）_
  
  - [x] 14.1.3 定义系统错误类
    - ConfigError（配置错误）
    - ServiceError（服务异常）
    - ResourceError（资源不足）
    - 包含详细的错误上下文信息
    - _相关文件：src/core/exceptions.py_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - [x] 14.1.4 定义网络错误类
    - APIError（API 调用失败）
    - TimeoutError（超时错误）
    - ConnectionError（连接错误）
    - 支持自动重试标记
    - _相关文件：src/core/exceptions.py_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - _验收标准：✅ 清晰的错误分类体系，✅ 所有错误消息中文化_

- [x] 14.2 实现统一错误响应 ✅
  - [x] 14.2.1 创建错误处理中间件
    - 捕获所有异常
    - 分类处理不同错误
    - 记录错误日志
    - _相关文件：web_app.py_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - [x] 14.2.2 格式化错误响应
    - 统一 JSON 响应格式
    - 错误码映射到 HTTP 状态码
    - 包含详细错误信息
    - _相关文件：web_app.py_
    - _设计引用：设计 4.2（错误响应）_
  
  - [x] 14.2.3 添加错误修复建议
    - 常见错误的修复建议
    - 提供修复步骤
    - 添加帮助文档链接
    - _相关文件：src/core/exceptions.py_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - [ ] 14.2.4 实现错误上报（可选，优先级：低）
    - 收集错误信息
    - 错误统计分析
    - 告警通知
    - _相关文件：src/core/error_reporter.py（新建）_
    - _说明：此为增强功能，可选实现_
  
  - _验收标准：✅ 友好的中文错误提示_

- [x] 14.3 前端错误处理 ✅
  - [x] 14.3.1 实现错误提示组件
    - Toast 通知组件
    - 错误对话框
    - 错误页面
    - _相关文件：static/js/error-handler.js_
  
  - [x] 14.3.2 显示友好错误信息
    - 中文错误消息
    - 图标提示
    - 颜色区分（错误/警告/信息）
    - _相关文件：static/js/error-handler.js_
  
  - [x] 14.3.3 添加重试按钮
    - 自动重试逻辑
    - 手动重试按钮
    - 重试次数限制
    - _相关文件：static/js/error-handler.js_
  
  - [x] 14.3.4 添加帮助链接
    - 文档链接
    - FAQ 链接
    - 联系支持
    - _相关文件：templates/error.html_
  
  - _验收标准：✅ 降低用户困惑，提供明确指引_

- [x] 14.4 错误处理测试（优先级：高）
  - [x] 14.4.1 编写错误类型单元测试
    - 测试错误消息格式
    - 测试错误码映射
    - 测试错误上下文
    - _相关文件：tests/unit/test_exceptions.py（新建）_
    - _需求引用：需求 3.3.3（单元测试）_
  
  - [x] 14.4.2 编写错误响应集成测试
    - 测试各类错误的响应格式
    - 测试 HTTP 状态码映射
    - 测试错误日志记录
    - _相关文件：tests/integration/test_error_handling.py（新建）_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - [x] 14.4.3 编写前端错误处理测试
    - 测试错误提示显示
    - 测试重试逻辑
    - 测试用户交互
    - _相关文件：tests/e2e/test_error_ui.py（新建）_
    - _需求引用：需求 3.5.2（错误处理）_
  
  - _验收标准：错误处理测试覆盖率 > 80%_

### 15. 批量处理（优先级：中，可选）
- [x] 15.1 后端批量处理实现
  - [x] 15.1.1 实现批量生成接口
    - 解析批量输入（多行文本或文件）
    - 任务分发和调度
    - 结果聚合
    - _相关文件：web_app.py_
    - _需求引用：需求 3.5.3（批量处理）_
  
  - [x] 15.1.2 实现任务队列（可选）
    - 使用 Celery 或简单队列
    - 任务调度
    - 优先级管理
    - _相关文件：src/core/task_queue.py（新建）_
    - _说明：简单场景可使用 asyncio，复杂场景考虑 Celery_
  
  - [x] 15.1.3 实现批量进度跟踪
    - 整体进度计算
    - 单个任务进度
    - 失败任务统计
    - _相关文件：web_app.py_
  
  - [x] 15.1.4 实现批量结果导出
    - Excel 导出
    - ZIP 打包下载
    - 生成下载链接
    - _相关文件：web_app.py_
  
  - _验收标准：支持批量操作，提供批量下载_

- [x] 15.2 前端批量处理界面
  - [x] 15.2.1 实现批量输入界面
    - 多行文本框输入
    - 文件上传（TXT/Excel）
    - 模板导入
    - _相关文件：templates/batch.html（新建）_
  
  - [x] 15.2.2 显示批量任务列表
    - 任务列表展示
    - 状态显示（进行中/成功/失败）
    - 操作按钮（重试/删除）
    - _相关文件：templates/batch.html_
  
  - [x] 15.2.3 显示批量进度
    - 整体进度条
    - 任务进度列表
    - 实时更新
    - _相关文件：static/js/batch.js（新建）_
  
  - [x] 15.2.4 实现批量下载
    - 打包下载所有结果
    - 单个结果下载
    - 下载管理
    - _相关文件：static/js/batch.js_
  
  - _验收标准：便捷的批量操作界面_

- [~] 15.3 批量处理测试
  - [~] 15.3.1 测试批量生成
    - 小批量测试（10条）
    - 中批量测试（50条）
    - 大批量测试（100条）
    - _相关文件：tests/integration/test_batch_generation.py_
  
  - [~] 15.3.2 测试失败重试
    - 单个失败重试
    - 批量重试
    - 重试策略
    - _相关文件：tests/integration/test_batch_generation.py_
  
  - [~] 15.3.3 测试并发限制
    - 并发数控制
    - 资源限制
    - 性能影响
    - _相关文件：tests/integration/test_batch_generation.py_
  
  - _验收标准：稳定的批量处理_

---

## ⏳ 阶段六：功能增强（未开始，优先级：低）

### 16. 模板管理（优先级：低，可选）
- [ ] 16.1 数据库设计和实现
  - [ ] 16.1.1 设计模板表结构
    - 模板基本信息（名称、描述、风格）
    - 模板配置（JSON 格式）
    - 模板统计（使用次数、评分）
    - _相关文件：docs/DATABASE_SCHEMA.md（新建）_
    - _说明：此为增强功能，当前阶段可选_
  
  - [ ] 16.1.2 创建数据库迁移
    - 使用 Alembic 或 Flask-Migrate
    - 版本管理
    - 回滚支持
    - _相关文件：migrations/（新建）_
  
  - [ ] 16.1.3 实现模板 CRUD
    - 创建模板
    - 读取模板
    - 更新模板
    - 删除模板
    - _相关文件：src/models/template.py（新建）_
  
  - _说明：模板管理为增强功能，建议在核心功能稳定后再实现_

- [ ] 16.2 后端 API 实现
  - [ ] 16.2.1 实现模板列表接口
  - [ ] 16.2.2 实现模板详情接口
  - [ ] 16.2.3 实现模板创建接口
  - [ ] 16.2.4 实现模板更新接口
  - _说明：此为增强功能，当前阶段可选_

- [ ] 16.3 前端界面实现
  - [ ] 16.3.1 实现模板列表页面
  - [ ] 16.3.2 实现模板预览
  - [ ] 16.3.3 实现模板选择
  - [ ] 16.3.4 实现模板编辑器
  - _说明：此为增强功能，当前阶段可选_

### 17. 历史记录（优先级：低，可选）
- [ ] 17.1 数据库设计和实现
  - [ ] 17.1.1 设计历史记录表
    - 记录基本信息
    - 输入输出数据
    - 元数据（时间戳、状态）
    - _相关文件：docs/DATABASE_SCHEMA.md_
    - _说明：此为增强功能，当前阶段可选_
  
  - [ ] 17.1.2 创建数据库迁移
  - [ ] 17.1.3 实现历史记录 CRUD
  - [ ] 17.1.4 添加索引优化
  - _说明：历史记录为增强功能，建议在核心功能稳定后再实现_

- [ ] 17.2 后端 API 实现
  - [ ] 17.2.1 实现历史记录保存
  - [ ] 17.2.2 实现历史记录列表接口
  - [ ] 17.2.3 实现历史记录搜索
  - [ ] 17.2.4 实现历史记录导出
  - _说明：此为增强功能，当前阶段可选_

- [ ] 17.3 前端界面实现
  - [ ] 17.3.1 实现历史记录页面
  - [ ] 17.3.2 实现历史记录搜索
  - [ ] 17.3.3 实现一键复用
  - [ ] 17.3.4 实现历史记录删除
  - _说明：此为增强功能，当前阶段可选_

### 18. 数据分析（优先级：低，可选）
- [ ] 18.1 数据收集
  - [ ] 18.1.1 实现事件埋点
  - [ ] 18.1.2 收集生成数据
  - [ ] 18.1.3 收集性能数据
  - [ ] 18.1.4 收集错误数据
  - _说明：数据分析为增强功能，当前阶段可选_

- [ ] 18.2 数据分析
  - [ ] 18.2.1 实现统计查询
  - [ ] 18.2.2 计算成功率
  - [ ] 18.2.3 分析耗时分布
  - [ ] 18.2.4 生成分析报告
  - _说明：此为增强功能，当前阶段可选_

- [ ] 18.3 可视化
  - [ ] 18.3.1 实现数据看板
  - [ ] 18.3.2 绘制趋势图表
  - [ ] 18.3.3 显示实时统计
  - [ ] 18.3.4 导出报表
  - _说明：此为增强功能，当前阶段可选_

---

## ⏳ 阶段七：部署与运维（未开始）

### 19. 容器化（优先级：中）
- [x] 19.1 创建 Dockerfile
  - [x] 19.1.1 编写 Dockerfile
    - 选择基础镜像（python:3.10-slim）
    - 安装系统依赖（字体等）
    - 安装 Python 依赖
    - 复制应用代码
    - _相关文件：Dockerfile（新建）_
    - _需求引用：需求 3.7（部署与运维）_
  
  - [x] 19.1.2 优化镜像大小
    - 使用多阶段构建
    - 清理 apt 缓存
    - 使用 slim 镜像
    - _相关文件：Dockerfile_
  
  - [x] 19.1.3 添加健康检查
    - 创建健康检查端点
    - 配置检查间隔
    - 失败重试策略
    - _相关文件：Dockerfile, web_app.py_
  
  - [x] 19.1.4 测试镜像构建
    - 本地构建测试
    - 运行容器测试
    - 性能测试
    - _相关文件：scripts/test_docker.sh（新建）_
  
  - _验收标准：可部署的 Docker 镜像_

- [x] 19.2 Docker Compose 配置
  - [x] 19.2.1 编写 docker-compose.yml
    - 定义应用服务
    - 配置网络
    - 配置环境变量
    - _相关文件：docker-compose.yml（新建）_
  
  - [x] 19.2.2 配置服务依赖（可选）
    - Redis 服务（如果使用）
    - PostgreSQL 服务（如果使用）
    - 服务依赖关系
    - _相关文件：docker-compose.yml_
    - _说明：根据实际需求配置，当前项目不需要额外服务依赖_
  
  - [x] 19.2.3 配置数据卷
    - 日志卷
    - 配置卷
    - 输出数据卷
    - _相关文件：docker-compose.yml_
  
  - [x] 19.2.4 测试容器编排
    - 启动测试
    - 服务通信测试
    - 数据持久化测试
    - _相关文件：scripts/test_compose.sh（新建）_
  
  - _验收标准：一键启动完整环境_

- [ ] 19.3 CI/CD 配置（可选）
  - [ ] 19.3.1 配置 GitHub Actions
    - 创建工作流文件
    - 配置触发条件
    - 配置环境变量
    - _相关文件：.github/workflows/ci.yml（新建）_
  
  - [ ] 19.3.2 实现自动测试
    - 运行单元测试
    - 运行集成测试
    - 生成测试报告
    - _相关文件：.github/workflows/ci.yml_
  
  - [ ] 19.3.3 实现自动构建
    - 构建 Docker 镜像
    - 推送到镜像仓库
    - 版本标签管理
    - _相关文件：.github/workflows/build.yml（新建）_
  
  - _说明：CI/CD 为增强功能，可选实现_

### 20. 监控告警（优先级：低，可选）
- [ ] 20.1 应用监控
  - [ ] 20.1.1 集成 Prometheus
    - 安装 Prometheus
    - 配置抓取目标
    - 配置存储
    - _说明：此为企业级功能，当前阶段可选_
  
  - [ ] 20.1.2 暴露监控指标
    - 请求计数
    - 响应时间
    - 错误率
  
  - [ ] 20.1.3 配置 Grafana
    - 安装 Grafana
    - 配置数据源
    - 导入仪表板
  
  - _说明：监控告警为增强功能，建议在生产环境部署时再实现_

- [ ] 20.2 日志监控（可选）
  - [ ] 20.2.1 集成 ELK Stack
  - [ ] 20.2.2 配置日志收集
  - [ ] 20.2.3 创建日志查询
  - [ ] 20.2.4 配置日志告警
  - _说明：此为企业级功能，当前阶段可选_

- [ ] 20.3 告警配置（可选）
  - [ ] 20.3.1 配置告警规则
  - [ ] 20.3.2 配置告警通知
  - [ ] 20.3.3 测试告警触发
  - [ ] 20.3.4 优化告警策略
  - _说明：此为企业级功能，当前阶段可选_

### 21. 文档完善（优先级：高）
- [x] 21.1 API 文档
  - [x] 21.1.1 使用 OpenAPI 规范
    - 定义 API 规范（YAML/JSON）
    - 添加请求/响应示例
    - 添加参数说明
    - _相关文件：docs/openapi.yaml（新建）_
    - _需求引用：需求 3.7（文档完善）_
  
  - [x] 21.1.2 生成 API 文档
    - 使用 Swagger UI 或 ReDoc
    - 自动生成文档页面
    - 配置在线访问
    - _相关文件：web_app.py_
  
  - [x] 21.1.3 添加使用示例
    - cURL 示例
    - Python 示例
    - JavaScript 示例
    - _相关文件：docs/API_EXAMPLES.md（新建）_
  
  - [x] 21.1.4 发布在线文档（可选）
    - 部署文档站点
    - 配置域名
    - 版本管理
    - _说明：可选功能，当前阶段跳过_
  
  - _验收标准：完整的 API 文档_

- [~] 21.2 开发文档
  - [~] 21.2.1 更新架构文档
    - 更新系统架构图
    - 更新模块说明
    - 记录技术选型
    - _相关文件：docs/ARCHITECTURE.md（新建）_
  
  - [~] 21.2.2 编写开发指南
    - 环境搭建步骤
    - 开发流程说明
    - 代码规范（引用 AGENTS.md）
    - _相关文件：docs/DEVELOPMENT.md（新建）_
  
  - [~] 21.2.3 编写部署指南
    - 部署步骤
    - 配置说明
    - 常见问题
    - _相关文件：docs/DEPLOYMENT.md（新建）_
  
  - [~] 21.2.4 编写故障排查指南
    - 常见问题列表
    - 排查步骤
    - 解决方案
    - _相关文件：docs/TROUBLESHOOTING.md（新建）_
  
  - _验收标准：完善的开发文档_

- [~] 21.3 用户文档
  - [~] 21.3.1 更新 README.md
    - 项目简介
    - 快速开始
    - 功能特性
    - _相关文件：README.md_
  
  - [~] 21.3.2 编写功能说明
    - 功能列表
    - 使用方法
    - 最佳实践
    - _相关文件：docs/USER_GUIDE.md（新建）_
  
  - [~] 21.3.3 编写 FAQ
    - 常见问题列表
    - 问题分类
    - 解决方案
    - _相关文件：docs/FAQ.md（新建）_
  
  - [ ] 21.3.4 录制视频教程（可选）
    - 功能演示
    - 操作指南
    - 技巧分享
    - _说明：可选功能_
  
  - _验收标准：友好的用户文档_

---

## 📋 验收标准

### 性能指标
- [x] 图片生成时间减少 60% 以上（已达成：并行生成）
- [ ] API 响应时间 P95 < 5秒
- [ ] 系统可用性 > 99%
- [ ] 并发支持 > 100 QPS

### 质量指标
- [x] 代码测试覆盖率 > 70%（核心模块已达成）
- [ ] 代码复杂度降低 30%
- [ ] mypy 类型检查通过率 100%
- [ ] pylint 评分 > 8.0

### 安全指标
- [ ] 无高危安全漏洞
- [ ] 敏感信息加密存储
- [ ] 所有输入经过验证
- [ ] HTTPS 强制启用

### 用户体验指标
- [ ] 用户错误率降低 50%
- [ ] 平均任务完成时间减少 40%
- [ ] 用户满意度 > 4.0/5.0
- [ ] 错误恢复成功率 > 90%

---

## 📝 任务优先级说明

### 🔴 高优先级（建议优先完成）
- 阶段三：代码重构、单元测试
- 阶段四：敏感信息保护、输入验证
- 阶段五：进度反馈、错误处理
- 阶段七：文档完善

### 🟡 中优先级（按需完成）
- 阶段二：Web 接口限流、缓存管理
- 阶段三：类型注解
- 阶段四：Web 安全
- 阶段五：批量处理
- 阶段六：模板管理、历史记录
- 阶段七：容器化、监控告警

### 🟢 低优先级（可选功能）
- 阶段六：数据分析

---

## 🎯 下一步行动建议

基于当前项目状态（阶段一、二、三已完成 100%，阶段四已完成 67%），建议按以下优先级推进：

### 近期重点（1-2周）

1. **完成错误处理测试**（阶段五 - 任务 14.4）⭐⭐⭐
   - 编写错误类型单元测试
   - 编写错误响应集成测试
   - 编写前端错误处理测试
   - _预计时间：2-3天_
   - _价值：确保错误处理的可靠性和完整性_
   - _验收标准：错误处理测试覆盖率 > 80%_

2. **批量处理功能**（阶段五 - 任务 15）⭐⭐⭐
   - 后端批量处理实现
   - 前端批量界面
   - 批量处理测试
   - _预计时间：1-2周_
   - _价值：提升效率，支持大规模使用_
   - _需求引用：需求 3.5.3（批量处理）_

3. **API 文档完善**（阶段七 - 任务 21.1）⭐⭐⭐
   - 使用 OpenAPI 规范定义 API
   - 生成 Swagger UI 文档
   - 添加使用示例
   - _预计时间：3-5天_
   - _价值：降低使用门槛，便于集成_
   - _需求引用：需求 3.7（文档完善）_

### 中期目标（2-4周）

4. **开发文档完善**（阶段七 - 任务 21.2）⭐⭐
   - 更新架构文档
   - 编写开发指南
   - 编写部署指南
   - 编写故障排查指南
   - _预计时间：1周_
   - _价值：降低维护成本，便于团队协作_
   - _需求引用：需求 3.7（文档完善）_

5. **容器化部署**（阶段七 - 任务 19）⭐⭐
   - 创建 Dockerfile
   - Docker Compose 配置
   - 测试容器编排
   - _预计时间：1周_
   - _价值：简化部署流程，提高可移植性_
   - _需求引用：需求 3.7（部署与运维）_

6. **用户文档编写**（阶段七 - 任务 21.3）⭐⭐
   - 更新 README.md
   - 编写功能说明
   - 编写 FAQ
   - _预计时间：3-5天_
   - _价值：提升用户体验，减少支持成本_

### 长期规划（可选）

7. **Web安全增强**（阶段四 - 任务 11.3, 12）⭐
   - 实现 XSS 过滤和路径遍历防护
   - 添加安全响应头
   - HTTPS 支持（生产环境）
   - _预计时间：1周_
   - _价值：提升 Web 应用安全性_
   - _说明：此为可选功能，当前基础安全已满足_
   - _需求引用：需求 3.4.2（输入验证）、需求 3.4.3（Web安全）_

8. **监控告警系统**（阶段七 - 任务 20）⭐
   - 集成 Prometheus 和 Grafana
   - 配置监控指标
   - 配置告警规则
   - _预计时间：1-2周_
   - _价值：提升系统可观测性_
   - _说明：此为企业级功能，建议在生产环境部署时再实现_

9. **功能增强**（阶段六 - 任务 16-18）⭐
   - 模板管理系统
   - 历史记录功能
   - 数据分析看板
   - _预计时间：2-3周_
   - _说明：此为增强功能，建议在核心功能稳定后再实现_
   - _需求引用：需求 3.6（功能增强）_

### 任务执行建议

- **优先级标记说明**：
  - ⭐⭐⭐ 高优先级（建议立即执行）
  - ⭐⭐ 中优先级（近期执行）
  - ⭐ 低优先级（长期规划）

- **执行原则**：
  1. 先完成高优先级任务
  2. 每完成一个阶段进行测试验证
  3. 及时更新文档
  4. 保持代码质量

- **风险控制**：
  1. 每次改动前创建分支
  2. 充分测试后再合并
  3. 保持向后兼容
  4. 及时备份数据

---

## 📚 相关文档

### 已完成功能文档
- [配置管理](../docs/CONFIG.md)
- [日志系统](../docs/LOGGER.md)
- [缓存管理](../docs/CACHE_MANAGER.md)
- [速率限制](../docs/RATE_LIMITER.md)
- [异步图片生成](../docs/ASYNC_IMAGE_GENERATION.md)
- [日志查询](../docs/LOG_QUERY.md)
- [测试指南](../docs/TESTING.md)

### 性能报告
- [性能优化总结](../PERFORMANCE_OPTIMIZATION.md)
- [性能测试报告](../PERFORMANCE_REPORT.md)

### 集成总结
- [缓存集成总结](../CACHE_INTEGRATION_SUMMARY.md)
- [日志收集集成](../docs/LOG_COLLECTOR_INTEGRATION.md)
- [日志告警集成](../docs/LOG_ALERTING_INTEGRATION.md)

---

**最后更新时间**: 2026-02-14  
**文档版本**: v3.2  
**更新说明**: 
- 更新项目进度概览，标记阶段五进度为 33%（任务 13 已完成，任务 14 部分完成）
- 完善任务 14（错误处理优化）的状态标记，添加任务 14.4（错误处理测试）
- 更新下一步行动建议，聚焦错误处理测试、批量处理和文档完善
- 调整任务优先级和时间估算，使其更符合当前项目状态
- 增强需求引用和设计引用的完整性
- 添加更具体的验收标准和价值说明
- 优化任务分组，使执行路径更清晰
