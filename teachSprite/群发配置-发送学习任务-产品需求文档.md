# 产品需求文档（PRD）

## 文档信息

| 项目 | 内容 |
|------|------|
| **需求名称** | 群发配置·发送学习任务能力扩展 |
| **产品/模块** | 群发任务配置 · 发送内容 |
| **文档版本** | V1.0 |
| **创建日期** | 2026-01-21 |
| **撰写人** | — |
| **关联文件** | `群发配置-发送内容扩展.html` |

### 变更记录

| 版本 | 日期 | 变更说明 | 负责人 |
|------|------|----------|--------|
| V1.0 | 2026-01-21 | 初稿：发送学习任务入口、弹窗流程、移除弹窗内发送班级、交互与透传点击修复 | — |

---

## 一、需求背景

在现有**群发任务配置**页的「发送内容」模块中，教师可配置群发文本、图片/视频/文件、学员个性化资料。为在群发场景下支持**一并发布学习任务**（试卷或自由任务），需在发送内容区域新增「发送学习任务」入口，并通过**弹窗逐层**完成任务类型选择、新建学习任务、选择试卷或添加题目等操作。  

同时，班级等已在群发页完成选择，弹窗内不再重复展示「发送班级」；学习任务相关交互仅由「发送学习任务」触发，与底部栏「发送」群发内容的职责分离。

---

## 二、需求目标

| 目标 | 说明 |
|------|------|
| 融合群发与学习任务 | 在群发配置流程中增加「发送学习任务」入口，支持发布试卷任务或自由任务至已在群发页选定的班级/学员。 |
| 弹窗逐层、闭环返回 | 以弹窗形式实现：选择任务类型 → 新建学习任务 → 试卷库/添加题目，各层支持返回至上一层或取消，不干扰底层页面操作。 |
| 避免重复与误用 | 弹窗内去掉「发送班级」，沿用外层已选班级；学习任务流程仅由「发送学习任务」触发，底部「发送」仅负责群发内容。 |
| 可用性与稳定性 | 未展示的弹窗不阻挡页面点击（含「发送学习任务」按钮），弹窗展示时底层可被遮罩正确覆盖。 |

---

## 三、用户与场景

| 用户角色 | 典型场景 |
|----------|----------|
| 教师 / 教务 | 在群发配置中编辑好群发文案后，希望同时给所选班级/学员发布一次学习任务（周测、作业等），无需退出群发再单独发任务。 |
| 教师 / 教务 | 发布任务时需选择「试卷」或「自由任务」：选试卷则从试卷库勾选；选自由任务则自行录入题目并支持图片、音视频、文件。 |

---

## 四、功能描述

### 4.1 发送内容区·新增「发送学习任务」入口

- **位置**：发送内容区块中，与「添加文本」「添加图片/视频/文件」「添加学员个性化资料」并列的第四个选项。
- **名称**：**发送学习任务**。
- **交互**：点击后弹出**第一层弹窗：选择任务类型**。
- **约束**：本入口为学习任务弹窗流程的**唯一触发点**；发送内容底部栏不再提供「发送任务」按钮；底部栏「发送」仅执行群发内容，不进入学习任务流程。

### 4.2 弹窗一：选择任务类型

- **展示**：居中弹窗，两项选项卡 + 底部「取消」。
  - 选项卡：**自由任务**、**试卷**。
  - 点击任一项即进入对应路径，并关闭本层。
- **取消**：点击「取消」或遮罩，关闭本弹窗，结束学习任务流程。
- **返回**：本层为第一层，无返回箭头。

### 4.3 弹窗二 a：新建学习任务（试卷模式）

- **入口**：在弹窗一选择「试卷」后打开。
- **标题**：新建学习任务。
- **头部**：左侧返回「&lt;」，右侧「暂存」「发布」。
- **内容**：
  - **输入任务说明**：多行文本，0/200 字。
  - **设置**（必填）：
    - 任务类型（点击选择）
    - 科目（点击选择）
    - ~~发送班级（点击选择）~~ **已移除**，沿用群发页已选班级。
    - 任务是否需要学生提交结果：开关，默认「是」
    - 任务截止时间：默认「发布后 7 天」示例值，可点击修改
    - 定时发送：开关，默认关
  - **+ 添加试卷**：绿色按钮，点击后进入**弹窗三 a：试卷库**，本层暂时关闭。
- **返回**：点击「&lt;」或遮罩，关闭本层，回到**弹窗一**。

### 4.4 弹窗三 a：试卷库

- **入口**：在弹窗二 a 点击「+ 添加试卷」后打开。
- **标题**：试卷库。
- **头部**：左侧返回「&lt;」。
- **内容**：
  - 搜索：按试卷名称。
  - 筛选：科目、试卷用途（如历年真题）等。
  - 试卷列表：勾选所需试卷（具体多选/单选与接口以实际实现为准）。
- **返回**：点击「&lt;」或遮罩，关闭本层，回到**弹窗二 a**。

### 4.5 弹窗二 b：新建学习任务（自由任务模式）

- **入口**：在弹窗一选择「自由任务」后打开。
- **布局**：与弹窗二 a 相同（任务说明、设置项，且同样**不展示发送班级**）。
- **差异**：在设置区下方为「题目」区块，绿色按钮为 **+ 添加题目**；点击后进入**弹窗三 b：添加题目**，本层暂时关闭。
- **返回**：点击「&lt;」或遮罩，回到**弹窗一**。

### 4.6 弹窗三 b：添加题目

- **入口**：在弹窗二 b 点击「+ 添加题目」后打开。
- **标题**：添加题目。
- **头部**：左侧返回「&lt;」，右侧「保存」。
- **内容**：
  - 输入作业内容：多行文本框。
  - 底部工具栏：图片、麦克风（语音）、摄像机（视频）、文件夹（文件）等附件入口。
- **返回**：点击「&lt;」或遮罩，关闭本层，回到**弹窗二 b**。

### 4.7 弹窗共性

- **层级与叠层**：弹窗一、二、三通过 `data-layer` 与 z-index 实现 1/2/3 层叠，高层打开时底层弹窗关闭，返回时重新打开对应底层。
- **遮罩**：每层配套遮罩；点击遮罩行为与同层「返回」一致（回到上一层或关闭）。
- **未展示时不挡点击**：未带 `.show` 的弹窗，其 `.modal` 使用 `pointer-events: none`，避免挡住页面「发送学习任务」等按钮。

---

## 五、业务流程 / 交互流程

```
发送内容区「发送学习任务」点击
    │
    ▼
┌─ 弹窗一：选择任务类型 ─────────────────────────────────────┐
│  [ 自由任务 ]  [ 试卷 ]          [ 取消 ]                   │
└────────────────────────────────────────────────────────────┘
    │ 选「试卷」                    │ 选「自由任务」              │ 取消 / 遮罩
    ▼                              ▼                          ▼
┌─ 弹窗二 a：新建学习任务（试卷）─┐  ┌─ 弹窗二 b：新建学习任务（自由）─┐   关闭，结束
│  任务说明、设置、[+ 添加试卷]   │  │  任务说明、设置、题目、[+ 添加题目] │
└────────────────────────────────┘  └──────────────────────────────────┘
    │ [+ 添加试卷]                        │ [+ 添加题目]
    ▼                                    ▼
┌─ 弹窗三 a：试卷库 ──────────────┐  ┌─ 弹窗三 b：添加题目 ────────────┐
│  搜索、筛选、试卷列表            │  │  输入作业内容、图/音/视/文件     │
└────────────────────────────────┘  └──────────────────────────────────┘
    │ 返回 / 遮罩                        │ 返回 / 遮罩
    └──────────► 弹窗二 a                └──────────► 弹窗二 b

各弹窗二、三的「返回」或遮罩：回到对应上一层；弹窗二 a / 二 b 的「返回」或遮罩：回到弹窗一。
```

---

## 六、验收标准

| 序号 | 验收项 | 预期 |
|------|--------|------|
| 1 | 发送内容区存在「发送学习任务」入口，且与添加文本、添加图片/视频/文件、添加学员个性化资料并列展示 | 符合 |
| 2 | 仅「发送学习任务」可打开学习任务弹窗流程；发送内容底部、底部栏「发送」均不触发该流程 | 符合 |
| 3 | 弹窗一可选择「自由任务」或「试卷」，并正确进入弹窗二 b 或二 a；取消/遮罩可关闭弹窗一 | 符合 |
| 4 | 弹窗二 a、二 b 均不展示「发送班级」；任务说明、设置项、添加试卷/添加题目按钮行为符合上述描述 | 符合 |
| 5 | 弹窗二 a 中「+ 添加试卷」可进入弹窗三 a（试卷库）；弹窗二 b 中「+ 添加题目」可进入弹窗三 b（添加题目） | 符合 |
| 6 | 各层「返回」及遮罩点击可回到上一层或弹窗一，且不发生 stacking / 焦点错乱 | 符合 |
| 7 | 所有弹窗关闭时，「发送学习任务」按钮可正常点击，不被透明弹窗阻挡 | 符合 |
| 8 | 弹窗三 a 具备搜索、筛选、试卷列表区域；弹窗三 b 具备作业内容输入与图/音/视/文件入口 | 符合 |

---

## 七、其他说明

### 7.1 与现有页面的关系

- **班级与对象**：班级、发送对象、选择学员均在群发配置主流程完成；弹窗内学习任务一律沿用当前群发页已选班级/学员，不再提供发送班级选择。
- **群发与学习任务**：群发内容（文本、多媒体、个性化资料）由底部「发送」提交；学习任务的创建与发布在弹窗内完成，通过「暂存」「发布」等按钮与后端学习任务接口对接。

### 7.2 后续可扩展

- 试卷库、添加题目与后端接口的对接（保存、发布、多选试卷、附件上传等）。
- 任务说明 0/200、作业内容等字符计数与校验。
- 任务类型、科目、任务截止时间、试卷用途等下拉/选择器的数据源与联动。
- 若产品需要，可将弹窗一改为底部 ActionSheet 等形式。

### 7.3 非功能

- 弹窗打开/关闭建议带简短过渡（如 opacity、transform），具体与现有 `群发配置-发送内容扩展.html` 中实现保持一致。
- 弹窗打开时可根据需要禁止 body 滚动，关闭时恢复。

---

*文档结束*
