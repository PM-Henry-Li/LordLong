# 学习任务 · 企业微信 H5 链接与落地页说明

## 统一入口

打开 **`teachSprite/index.html`** 可通过**左侧菜单**在「群发配置」「学习任务 H5」「做任务-试卷」之间切换；各页面单独打开或通过原有点击（如 去完成）的跳转逻辑保持不变，在统一入口内时由 iframe 承载，**去完成** 等跳转会通过 postMessage 同步右侧内容与左侧菜单高亮。

---

## 一、效果说明

任务发送后，在企业微信会话中会收到一条**带 H5 链接的消息**。企业微信会抓取该链接的**摘要信息**，在会话里展示为**链接卡片**（参考企微页面.jpg 中「东北人的独特存在…」「598元! 苹果新品…」等卡片形式）。学员/家长**点击卡片或链接**后，在企微内置浏览器中打开 **H5 落地页**，可查看任务详情并「去完成」。

### 预览方式（学习任务-H5落地页.html）

- **默认**：以 **HTML 拟真企微界面** 为背景（左侧导航、中间会话列表、右侧主会话区 + 右侧信息面板），学习任务卡片嵌在**主会话区**，并带有发送人「张老师@新东方在线」、时间分割线、底部输入栏等，整体更贴近真实企微。
- **?bg=img**：以 **base_info/企微页面.jpg** 为全屏背景，仅在会话区叠放学习任务卡片，适合对照真实企微截图做视觉核对。需保证 `base_info/企微页面.jpg` 与 HTML 同项目可访问。

### 去完成 → 试卷详情

在学习任务卡片点击 **「去完成」** 时：

- **试卷**（`type=paper` 或默认）：跳转到 **做任务-试卷详情.html**，展示做任务头、任务概览、试卷卡片（绿色 EXAMINATION 横幅、练习题数）、**「开始作答」** 按钮；支持 URL 参数 `taskId`、`title`、`due`、`quizTitle`、`count` 回填。
- **自由任务**（`type=free`）：当前为占位提示，自由任务详情页待实现。

### 1. 会话中的链接卡片（由企业微信自动生成）

企业微信会根据 H5 页面的 **Open Graph 等 meta** 生成卡片，形式与参考图类似：

| 卡片元素 | 对应 meta / 说明 |
|----------|------------------|
| **标题** | `og:title`，如「【学习任务】概率论周测」 |
| **描述/摘要** | `og:description`，如「考研数学 · 截止01月27日18:00 · 张老师发布」 |
| **缩略图** | `og:image`，建议 400×300 或 1.91:1，任务封面或默认图 |
| **来源** | `og:site_name`，如「新东方在线 · 学习任务」 |

`学习任务-H5落地页.html` 已按上述填写示例，发布时需改为**实际任务数据**与**可公网访问的 og:image 地址**。

### 2. 点击后打开的 H5 落地页

落地页采用与企微链接卡片相近的**卡片式布局**：

- **顶标**：学习任务
- **左侧**：任务名称、发布人、科目、截止时间、任务类型（试卷/自由任务）、是否需提交
- **右侧**：缩略图/封面（占位图标或实际封面）
- **说明**：任务说明摘要（可折行截断）
- **主按钮**：「去完成」→ 跳转到你们的做题/详情页
- **底部**：来源，如「来自 新东方在线 · 学习任务」

适配手机端，适合在企微内置浏览器中打开。

---

## 二、文件与占位

| 文件 | 用途 |
|------|------|
| **`index.html`** | **统一入口**：左侧菜单（群发配置、学习任务 H5、做任务-试卷）与 iframe 内容区；页面内原有跳转（如 去完成）仍可用，若在 iframe 内则通过 postMessage 由父级切换并高亮对应菜单 |
| `群发配置-发送内容扩展.html` | 群发配置页：发送学习任务入口、弹窗流程、企微拟真等 |
| `学习任务-H5落地页.html` | 学习任务 H5 落地页；同时包含 og 等 meta，供企微生成会话中的链接卡片；「去完成」试卷时跳转 `做任务-试卷详情.html`（在 iframe 内时通知父级） |
| `做任务-试卷详情.html` | 试卷类任务的做任务详情页：做任务头、任务概览、试卷卡片（EXAMINATION 横幅、练习题数）、「开始作答」；支持 `taskId,title,due,quizTitle,count` 回填 |

### 需要后端/发布时替换的内容

1. **og:title**：任务名称，建议带「学习任务」前缀，如「【学习任务】概率论周测」  
2. **og:description**：短摘要，如「考研数学 · 截止01月27日18:00 · 张老师发布」  
3. **og:image**：任务封面图 **CDN 可公网访问 URL**；无封面时用默认学习任务图  
4. **og:url**：该 H5 的**最终访问地址**（含 `taskId` 等参数）  
5. **落地页正文**：标题、发布人、科目、截止时间、任务类型、说明、需提交等，由服务端根据 `taskId` 输出或前端请求接口填充  
6. **「去完成」跳转**：`taskId`（或其它 id）从 URL 取，跳转到你们现有的做题/详情页

### URL 参数约定（示例）

- `taskId`：任务 ID，用于落地页拉取详情与「去完成」跳转  
- `type`：`paper` | `free`，用于展示「试卷」或「自由任务」

示例：

`https://your-domain.com/task/h5?id=xxx&type=paper`

---

## 三、和「发送学习任务」的衔接

1. 教师在群发配置中通过**发送学习任务**弹窗完成新建并发布（试卷或自由任务）。  
2. 发布成功后的**消息内容**中，需要包含该任务的 **H5 链接**（即上述 og:url 的地址）。  
3. 该链接在企微会话中会以**卡片形式**展示；点击后打开 `学习任务-H5落地页` 所对应的页面（或你们根据同一规范实现的等价 H5）。  
4. 学员在落地页点击「去完成」，跳转到你们的做题/详情系统。

---

## 四、自由任务与试卷的差异

落地页通过 `?type=free` 与 `?type=paper` 区分展示：

- `type=paper`（默认）：任务类型处显示「试卷」  
- `type=free`：任务类型处显示「自由任务」

其它结构一致；若需更多差异（如自由任务不展示「需提交」），可在落地页或接口中扩展。

---

## 五、注意事项

- **og:image** 须为 **HTTPS、可公网访问**，否则企微可能不展示缩略图。  
- 标题、描述不宜过长，以免在卡片中截断过多。  
- 落地页需在**企微内置浏览器**中可正常打开；若有登录或域名白名单，请一并配置。
